---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Icon } from 'astro-icon/components';
import { getReleaseData } from '../lib/release-data';
import { withBasePath } from '../lib/paths';

interface Props {
  releaseSlug?: string;
}

const { releaseSlug } = Astro.props as Props;
const { release, pluginData, filtersData, eventsData } = getReleaseData(releaseSlug);
const basePath = release.basePath;
const mfes = pluginData.mfes.sort((a, b) => a.name.localeCompare(b.name));
---

<BaseLayout
  title="Frontend Applications"
  basePath={basePath}
  release={release.slug}
  pluginData={pluginData}
  filtersData={filtersData}
  eventsData={eventsData}
  showSidebar
>
  <section class="space-y-4">
      <div class="flex flex-wrap items-center gap-2">
          <h1 class="text-4xl font-bold">Frontend Applications</h1>
          <span class="badge badge-primary gap-1 py-3">
              <Icon name="tabler:puzzle" width="0.95rem" height="0.95rem" is:inline />
              {pluginData.pluginSlots.length} Slots
          </span>
          <span class="badge badge-secondary gap-1 py-3">
              <Icon name="tabler:blocks" width="0.95rem" height="0.95rem" is:inline />
              {mfes.length} MFEs
          </span>
      </div>
    <p class="max-w-3xl text-base-content/75">
        All Open edX MFEs with plugin slots.
    </p>
  </section>

  <section class="mt-6 grid gap-4 md:grid-cols-2 xl:grid-cols-3">
    {mfes.map((mfe) => (
      <article class="mfe-card card border border-base-300 bg-base-100 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md">
        <div class="card-body gap-4 p-6">
          <h2 class="card-title text-lg leading-tight">
            <a href={withBasePath(basePath, `/mfes/${mfe.id}`)} class="link link-primary link-hover">
              {mfe.name}
            </a>
          </h2>
          <p class="text-sm leading-6 text-base-content/80">{mfe.description || 'No description available'}</p>
          <div class="flex flex-wrap items-center justify-between gap-3 border-t border-base-300 pt-4 text-sm">
            <span class="inline-flex items-center gap-1 text-primary">
              <Icon name="tabler:plug" width="0.95rem" height="0.95rem" />
              {mfe.pluginSlotsCount || 0} plugin slots
            </span>
            <a href={mfe.repository} target="_blank" rel="noopener noreferrer" class="link link-primary">View on GitHub</a>
          </div>
          {mfe.topics && mfe.topics.length > 0 && (
            <div class="flex flex-wrap gap-2 pt-1">
              {mfe.topics.map((topic) => (
                <span class="badge badge-ghost badge-sm">{topic}</span>
              ))}
            </div>
          )}
        </div>
      </article>
    ))}
  </section>
</BaseLayout>
