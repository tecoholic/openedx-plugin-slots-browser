---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Icon } from 'astro-icon/components';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import { withBasePath } from '../lib/paths';

interface Props {
  release: { slug: string; basePath: string };
  pluginData: { pluginSlots: any[]; mfes: any[] };
  filtersData: { filters: any[] };
  eventsData: { events: any[] };
  event: any;
}

const { release, pluginData, filtersData, eventsData, event } = Astro.props as Props;
const basePath = release.basePath;
---

<BaseLayout
  title={event.eventName}
  basePath={basePath}
  release={release.slug}
  pluginData={pluginData}
  filtersData={filtersData}
  eventsData={eventsData}
  showSidebar
  showEvents
  currentEventId={event.id}
>
  <section class="space-y-4">
    <Breadcrumbs
      items={[
        { label: 'Events', href: withBasePath(basePath, '/events') },
        { label: event.eventName },
      ]}
    />
    <div class="flex flex-wrap items-start justify-between gap-3">
      <h1 class="text-4xl font-bold">{event.eventName}</h1>
      <a href={event.sourceUrl} target="_blank" rel="noopener noreferrer" class="btn btn-primary btn-sm">
        <Icon name="tabler:external-link" width="1rem" height="1rem" /> View Source
      </a>
    </div>
  </section>

  <section class="mt-6 overflow-x-auto rounded-box border border-base-300 bg-base-100">
    <table class="table table-zebra">
      <tbody>
        <tr>
          <th class="w-44">Namespace</th>
          <td>{event.namespace}</td>
        </tr>
        <tr>
          <th>Event Type</th>
          <td><code>{event.eventType}</code></td>
        </tr>
        {event.description && (
          <tr>
            <th>Description</th>
            <td>{event.description}</td>
          </tr>
        )}
        <tr>
          <th>File Path</th>
          <td><code>{event.filePath}</code></td>
        </tr>
        <tr>
          <th>Last Updated</th>
          <td>{new Date(event.lastUpdated).toLocaleDateString()}</td>
        </tr>
      </tbody>
    </table>
  </section>

  {event.dataClasses && event.dataClasses.length > 0 && (
    <section class="mt-6 space-y-4">
      <h2 class="text-2xl font-semibold">Event Data</h2>
      <div class="space-y-4">
        {event.dataClasses.map((dataClass) => (
          <article class="card border border-base-300 bg-base-100 shadow-sm">
            <div class="card-body gap-3">
              {dataClass.dataKey && (
                <div>
                  <span class="badge badge-outline"><code>{dataClass.dataKey}</code></span>
                </div>
              )}
              <h3 class="card-title text-lg">{dataClass.name}</h3>
              {dataClass.description && <p class="text-sm text-base-content/80">{dataClass.description}</p>}

              {dataClass.attributes && dataClass.attributes.length > 0 && (
                <div class="space-y-2">
                  <h4 class="font-semibold">Attributes</h4>
                  <div class="overflow-x-auto rounded-box border border-base-300">
                    <table class="table table-zebra table-sm">
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>Type</th>
                          <th>Description</th>
                        </tr>
                      </thead>
                      <tbody>
                        {dataClass.attributes.map((attr) => (
                          <tr>
                            <td class="font-semibold">{attr.name}</td>
                            <td><code>{attr.type}</code></td>
                            <td>{attr.description || 'â€”'}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              )}
            </div>
          </article>
        ))}
      </div>
    </section>
  )}

  <div class="mt-6">
    <a href={withBasePath(basePath, '/events')} class="btn btn-ghost btn-sm">Back to Events</a>
  </div>
</BaseLayout>
