---
import SlotDetailPage from '../../../../../../views/SlotDetailPage.astro';
import { getReleaseData } from '../../../../../../lib/release-data';
import { releaseSlugs } from '../../../../../../lib/release-config';
import { withBasePath } from '../../../../../../lib/paths';

export function getStaticPaths() {
  return releaseSlugs.flatMap((slug) => {
    const { pluginData } = getReleaseData(slug);
    return pluginData.pluginSlots.map((slot) => ({
      params: { release: slug, mfe: slot.mfeId, slotId: slot.id },
    }));
  });
}

const { release, mfe, slotId } = Astro.params;
const { release: releaseInfo, pluginData, filtersData, eventsData } = getReleaseData(release);
const slot = pluginData.pluginSlots.find((s) => s.mfeId === mfe && s.id === slotId);
const mfeInfo = pluginData.mfes.find((m) => m.id === mfe);

if (!slot || !mfeInfo) {
  return Astro.redirect(withBasePath(releaseInfo.basePath, '/'));
}
---

<SlotDetailPage
  release={releaseInfo}
  pluginData={pluginData}
  filtersData={filtersData}
  eventsData={eventsData}
  slot={slot}
  mfe={mfeInfo}
/>
